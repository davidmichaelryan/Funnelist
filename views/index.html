<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Funnelist</title>
    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/index.css" rel="stylesheet">
  </head>
  <body>
    <div class="container" style="width:1170px">
      <h1 class="super-header">Funnelist</h1>

      <h1 style="text-align:center;">{{ title }}</h1>
      <div class="row">
        <div class="col-xs-5">
          <h2>Recent Timeline</h2>
          <ul class="timeline">
            {{# timeline }}
              <li>
                <h3>@{{ username }}</h3>
                <p>{{ tweet }}</p>
              </li>
            {{/ timeline }}
          </ul>
          {{^ timeline }}
            <p>The timeline can't be retreived at this time...</p>
          {{/ timeline }}
        </div>
        <div class="col-xs-4">
          <h2>Users</h2>
          <div class="btn sort-dict-button">Sort dictionary</div>
          <ul class="user-list">
            {{# users }}
              <li data-dicthits = "{{ metrics.dictionaryHits }}">
                <h3>@{{ screen_name }}</h3>
                <h4>Metrics:</h4>
                <p>FF ratio: {{ metrics.ff_ratio }}</p>
                <p>{{^ metrics.verified }}Not {{/ metrics.verified }}Verified</p>
                <p>Dictionary Hits: {{metrics.dictionaryHits}}</p>
                {{# canwrite }}<p><a class="delete-button" data-user="{{ screen_name }}">Remove user</a></p>{{/ canwrite }}
              </li>
            {{/ users }}
          </ul>
          {{^ users }}
            <p>can't get users at this time...</p>
          {{/ users }}
        </div>
        <div class="col-xs-3">
          <h2>Suggestions</h2>
          <h4>Users mentioned by others </h4>
           <ul class="mentions-list">
              {{# mentions }}
                <li>
                  <!-- <p><strong>{{ username }}:</strong> {{ count }}</p>
                  <p><a target="_blank" href="https://twitter.com/{{ username }}">Go to profile</a></p>  -->
                  <p><strong><a target="_blank" href="https://twitter.com/{{ username }}">{{ username }}:</a><strong> {{ count }}</p> 

                 {{# canwrite }} <p><a class="add-button" data-user="{{ username }}">Add user</a></p>{{/ canwrite }}
                </li>
              {{/ mentions }}
          </ul>
        </div>
      </div>
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script>
      {{# canwrite }}
      $('.add-button').click(function() {  
        var username = $(this).attr('data-user');
        $.post( "/adduser", 
          {
            list: "{{ listname }}",
            owner: "{{ ownername }}",
            user: username
          },
          function( data ) {
            alert( "User was added to the list" );
        });
      });

      $('.delete-button').click(function() {  
        var username = $(this).attr('data-user');
        $.post( "/removeuser", 
          {
            list: "{{ listname }}",
            owner: "{{ ownername }}",
            user: username
          },
          function( data ) {
            alert( "User was deleted from the list" );
        });
      });
      {{/ canwrite }}

      $(".sort-dict-button").click(function() {
        $(".user-list li").sort(sort_li).appendTo('.user-list');
        function sort_li(a, b){
            return ($(b).data('dicthits')) > ($(a).data('dicthits')) ? 1 : -1;    
        }
      });

    </script>
  </body>
</html>
